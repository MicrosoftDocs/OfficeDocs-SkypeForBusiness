---
title: 'Lync Server 2013: Testing the replica service'
TOCTitle: Testing the replica service
ms:assetid: 4ff2cc91-0036-4c5a-9792-7bf43d8ce18d
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Dn727303(v=OCS.15)
ms:contentKeyID: 63969600
ms.date: 01/27/2015
mtps_version: v=OCS.15
---

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# Testing the replica service in Lync Server 2013

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**Topic Last Modified:** 2014-11-03_


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Verification schedule</p></td>
<td><p>Daily</p></td>
</tr>
<tr class="even">
<td><p>Testing tool</p></td>
<td><p>Windows PowerShell</p></td>
</tr>
<tr class="odd">
<td><p>Permissions required</p></td>
<td><p>When run locally using the Lync Server Management Shell, users must be members of the RTCUniversalServerAdmins security group.</p>
<p>When run using a remote instance of Windows PowerShell, users must be assigned an RBAC role that has permission to run the <strong>Test-CsReplica</strong> cmdlet. To see a list of all RBAC roles that can use this cmdlet, run the following command from the Windows PowerShell prompt:</p>
<pre><code>Get-CsAdminRole | Where-Object {$_.Cmdlets -match &quot;Test-CsReplica&quot;}</code></pre></td>
</tr>
</tbody>
</table>


<div>

## Description

The **Test-CsReplica** cmdlet verifies that the Lync Server 2013 replica service is running on the local computer. The **Test-CsReplica** cmdlet performs such tasks as:

  - checking the status of the Replicator Agent and Centralized Logging Agent services

  - verifying that the required ports were opened in the Windows Firewall

  - making sure that the necessary Active Directory and local computer security groups exist.

Note that this cmdlet must be run locally. That is, it must be run on the same computer where the replica service is running. There are no options for running the **Test-CsReplica** cmdlet against a remote server.

</div>

<div>

## Running the test

The command shown in Example 1 tests the Lync Server 2013 replica service on the local computer. In this example the Verbose parameter is used to guarantee that information about the test – including the eventual failure or success of the test and the location of the report generated by the test – is displayed on screen.

    Test-CsReplica -Verbose

Example 2 is a variation of the command shown in Example 1. In this case, the Report parameter is included to specify a folder path and name for the report generated by the test. If you do not specify a report path the report will be given an auto-generated name similar to this:

C:\\Users\\Administrator.Litwareinc\\AppData\\Local\\Temp\\1\\Test-Cs-Replica-3db40ee0-4b5d-4f58-8d3d-b1e61253129e.html

    Test-CsReplica -Verbose -Report C:\Logs\ReplicaTest.html

</div>

<div>

## Determining success or failure

Insert section body here.

VERBOSE: Creating new log file "C:\\Users\\Testing\\AppData\\Local\\Temp\\Test-CsReplica-3cb066b3-dd23-411a-8932-99f01c0f940c.xml".

VERBOSE: Creating new log file "C:\\Users\\Testing\\AppData\\Local\\Temp\\Test-CsReplica-3cb066b3-dd23-411a-8932-99f01c0f940c.xml".

VERBOSE: "Test-CsReplica" processing has completed successfully.

VERBOSE: Detailed results can be found at "C:\\Users\\Testing\\AppData\\Local\\Temp\\Test-CsReplica-3cb066b3-dd23-411a-8932-99f01c0f940c.xml".

VERBOSE: Creating new log file

"C:\\Users\\Testing\\AppData\\Local\\Temp\\2\\Test-CsReplica-29fddb35-f56e-4e3c-8f4c-e

d3bd0e4a083.xml".

VERBOSE: Creating new log file

"C:\\Users\\Testing\\AppData\\Local\\Temp\\2\\Test-CsReplica-29fddb35-f56e-4e3c-8f4c-e

d3bd0e4a083.html".

WARNING: Test-CsReplica failed.

WARNING: Detailed results can be found at

"C:\\Users\\Testing\\AppData\\Local\\Temp\\2\\Test-CsReplica-29fddb35-f56e-4e3c-8f4c-e

d3bd0e4a083.html".

Test-CsReplica : Command execution failed: Requested registry access is not

allowed.

At line:1 char:1

\+ Test-CsReplica -Verbose

\+ ~~~~~~~~~~~~~~~~~~~~~~~

\+ CategoryInfo : InvalidOperation: (:) \[Test-CsReplica\], Security

Exception

\+ FullyQualifiedErrorId : ProcessingFailed,Microsoft.Rtc.Management.Deploy

ment.TestReplicaCmdlet

PS C:\\Users\\Testing\>

PS C:\\Users\\Testing\> Test-CsUcwaConference -TargetFqdn "LyncTest.SelfHost.Corp.M

icrosoft.com"

WARNING: Failed to read Registrar port number for the given fully qualified

domain name (FQDN). Using default Registrar port number. Exception:

System.InvalidOperationException: No matching cluster found in topology.

at

Microsoft.Rtc.Management.SyntheticTransactions.SipSyntheticTransaction.TryRetri

eveRegistrarPortFromTopology(Int32& registrarPortNumber)

Test-CsUcwaConference : There is no test user assigned for

\[LyncTest.SelfHost.Corp.Microsoft.com\]. Verify test user configuration.

At line:1 char:1

\+ Test-CsUcwaConference -TargetFqdn "LyncTest.SelfHost.Corp.Microsoft.com"

\+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

\+ CategoryInfo : ResourceUnavailable: (:) \[Test-CsUcwaConference\]

, InvalidOperationException

\+ FullyQualifiedErrorId : NotFoundTestUsers,Microsoft.Rtc.Management.Synth

eticTransactions.TestUcwaConferenceCmdlet

</div>

<div>

## Reasons why the test might have failed

Here are some common reasons why **Test-CsReplica** might fail:

  - There may be a larger problem with the Replicator Agent and Centralized Logging Agent services

  - The required ports may not be open in the Windows Firewall

  - The necessary Active Directory and local computer security groups may not exist

</div>

</div>

<span> </span>

</div>

</div>

</div>

